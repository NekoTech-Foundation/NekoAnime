(function(){"use strict";const g="1.0.45",p=typeof navigator!="undefined"&&(navigator==null?void 0:navigator.userAgent.includes("Firefox")),y=typeof btoa=="function",E=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder,typeof TextEncoder=="function"&&new TextEncoder;const b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=Array.prototype.slice.call(b);(r=>{let s={};return r.forEach((n,e)=>s[n]=e),s})(d),String.fromCharCode.bind(String),typeof Uint8Array.from=="function"&&Uint8Array.from.bind(Uint8Array);const w=y?r=>btoa(r):E?r=>Buffer.from(r,"binary").toString("base64"):r=>{let s,n,e,t,i="";const a=r.length%3;for(let o=0;o<r.length;){if((n=r.charCodeAt(o++))>255||(e=r.charCodeAt(o++))>255||(t=r.charCodeAt(o++))>255)throw new TypeError("invalid character found");s=n<<16|e<<8|t,i+=d[s>>18&63]+d[s>>12&63]+d[s>>6&63]+d[s&63]}return a?i.slice(0,a-3)+"===".substring(a):i};function v(r){let s="";const n=new Uint8Array(r),e=n.byteLength;for(let t=0;t<e;t++)s+=String.fromCharCode(n[t]);return w(s)}const k=p?r=>JSON.stringify(r):r=>r;function W(){const r=window.Worker;class s{constructor(e,t){this.realWorker=null,this.queue=[],this.listeners=new Map,this._onmessage=null,this._onerror=null,this._onmessageerror=null,this.init(e,t)}async init(e,t){try{const i=e.startsWith("http")?new URL(e):void 0,a=await fetch(i?i.pathname+i.search:e);if(!a.ok)throw new Error(`Failed to fetch worker: ${a.status}`);const o=await a.text(),f=new Blob([o],{type:"application/javascript"}),T=URL.createObjectURL(f),m=new r(T,{type:"classic",...t});this.realWorker=m,m.addEventListener("message",l=>{var h,u;(h=this._onmessage)==null||h.call(this,l),(u=this.listeners.get("message"))==null||u.forEach(c=>{typeof c=="function"?c.call(this,l):typeof c.handleEvent=="function"&&c.handleEvent(l)})}),m.addEventListener("messageerror",l=>{var h,u;(h=this._onmessageerror)==null||h.call(this,l),(u=this.listeners.get("messageerror"))==null||u.forEach(c=>{typeof c=="function"?c.call(this,l):typeof c.handleEvent=="function"&&c.handleEvent(l)})}),m.addEventListener("error",l=>{var h,u;(h=this._onerror)==null||h.call(this,l),(u=this.listeners.get("error"))==null||u.forEach(c=>{typeof c=="function"?c.call(this,l):typeof c.handleEvent=="function"&&c.handleEvent(l)})}),this.queue.forEach(({method:l,args:h})=>{m[l](...h)}),this.queue=[]}catch(i){console.error("CORSWorker init error:",i)}}postMessage(...e){this.realWorker?this.realWorker.postMessage(...e):this.queue.push({method:"postMessage",args:e})}terminate(){this.realWorker?this.realWorker.terminate():this.queue.push({method:"terminate",args:[]})}get onmessage(){return this._onmessage}set onmessage(e){this._onmessage=e,this.realWorker&&(this.realWorker.onmessage=t=>{e==null||e.call(this,t),this.dispatchEvent(t)})}get onerror(){return this._onerror}set onerror(e){this._onerror=e,this.realWorker&&(this.realWorker.onerror=t=>{e==null||e.call(this,t),this.dispatchEvent(t)})}get onmessageerror(){return this._onmessageerror}set onmessageerror(e){this._onmessageerror=e,this.realWorker&&(this.realWorker.onmessageerror=t=>{e==null||e.call(this,t),this.dispatchEvent(t)})}addEventListener(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}removeEventListener(e,t){var i;(i=this.listeners.get(e))==null||i.delete(t)}dispatchEvent(e){const t=e.type,i=this.listeners.get(t);if(!i)return!0;for(const a of i)try{typeof a=="function"?a.call(this,e):typeof a.handleEvent=="function"&&a.handleEvent(e)}catch(o){console.error("Error in event listener:",o)}return!0}}Object.assign(window,{Worker:s})}function L(){const r=new class{constructor(){this.store=new Map}on(n,e){return this.store.set(n,e),()=>this.store.delete(n)}};document.addEventListener("http:aborted",({detail:{signalId:s}})=>{var n;(n=r.store.get(s))==null||n()}),document.addEventListener("http:request",async({detail:s})=>{let n;const{data:e,signalId:t}=s.req;e&&(typeof e=="object"?(n=new FormData,Object.entries(e!=null?e:{}).forEach(([o,f])=>n.append(o,f))):n=e);let i,a;if(t){const o=new AbortController;i=o.signal,t===!0?o.abort():a=r.on(t,()=>{o.abort(),a==null||a()})}document.dispatchEvent(new CustomEvent("http:response",{detail:k(await fetch(s.req.url,{...s.req,body:n,signal:i}).then(async o=>{const f={headers:Object.fromEntries(o.headers.entries()),data:"",url:o.url,status:o.status};switch(s.req.responseType){case"arraybuffer":f.data=p?await o.text():v(await o.arrayBuffer());break;case"json":f.data=await o.json();break;default:f.data=await o.text()}return{id:s.id,isBuffer:p&&s.req.responseType==="arraybuffer",ok:!0,res:f}}).catch(o=>({id:s.id,ok:!1,res:o})))}))}),document.documentElement.dataset.httpVersion=g,document.documentElement.dataset.httpAllow=JSON.stringify(!0),document.documentElement.dataset.tabsApi=JSON.stringify(!1),document.documentElement.dataset.customReferer=JSON.stringify(!1)}async function A(){var n;const r=(n=window.patcher)!=null?n:"https://animevsub.eu.org";document.documentElement.innerHTML="";const s=await fetch(r).then(e=>e.text());document.documentElement.innerHTML=`<base href="${r}" />${s}`,document.querySelectorAll("script").forEach(e=>{if(e.src.includes("adguard"))return;const t=document.createElement("script");t.innerHTML=e.innerHTML,t.src=e.src,t.type=e.type,e.replaceWith(t)})}function S(){W(),L(),A()}if(new URLSearchParams(location.search.slice(1)).get("patch")==="true"&&localStorage.setItem("patch","true"),location.host.startsWith("animevietsub")&&localStorage.getItem("patch")==="true"){let r=function(){document.documentElement.innerHTML.includes("Trang ch\u1EE7")&&S()};document.addEventListener("DOMContentLoaded",r),addEventListener("load",r),r()}})();
